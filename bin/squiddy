#!/usr/bin/env ruby

require_relative '../lib/squiddy'

def check_environment_variable(name)
  name = "SQUIDDY_#{name.upcase}"

  if ENV[name].nil?
    abort("ERROR: Must provide #{name} environment variable")
  end
end

event = Squiddy::Event.new
puts "GITHUB_REF: #{event.ref}"

case event.type
when "pull_request"
  %w(trello_developer_public_key trello_member_token github_access_token issue_number).each do |env|
    check_environment_variable(env)
  end

  Squiddy::TrelloPullRequest.run(pull_request_number: ENV['SQUIDDY_ISSUE_NUMBER'])
else
  puts "Nothing to do!"
end
